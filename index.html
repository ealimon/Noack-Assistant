<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Noack Assistant — Minimal Preview</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root { --primary:#0b57d0; --bg:#fff; --text:#1f2328; --muted:#5f6b7a; --border:#d9dee3; --shadow:0 10px 30px rgba(0,0,0,.16); --radius:12px; }
    * { box-sizing: border-box; }
    body { margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; color:var(--text); }
    .hero { padding: 40px 20px 80px; max-width: 900px; margin: 0 auto; }
    .hero h1 { margin: 0 0 10px; font-size: 32px; }
    .hero p { margin: 0 0 20px; color: var(--muted); }
    .open-btn { position: fixed; top: 14px; right: 14px; background: var(--primary); color: #fff; border: 0; border-radius: 8px; padding: 10px 12px; cursor: pointer; box-shadow: var(--shadow); }/* Lightbox */
.overlay { position: fixed; inset: 0; background: rgba(0,0,0,.45); display: none; }
.overlay.open { display: block; }
.modal { position: fixed; right: 20px; bottom: 20px; width: min(420px, calc(100vw - 32px)); height: min(70vh, 620px); background: var(--bg); border-radius: var(--radius); box-shadow: var(--shadow); border: 1px solid var(--border); overflow: hidden; display: none; }
.modal.open { display: flex; flex-direction: column; }
.header { display: flex; align-items: center; justify-content: space-between; padding: 10px 12px; border-bottom: 1px solid var(--border); background: #f6f7f9; }
.title { font-weight: 600; }
.close { background: transparent; border: 0; cursor: pointer; font-size: 18px; color: var(--muted); }
.messages { flex: 1; overflow-y: auto; padding: 12px; background: linear-gradient(180deg,#fafbfc 0%,#ffffff 35%); }
.msg { padding: 10px 12px; margin: 8px 0; max-width: 85%; border-radius: 12px; line-height: 1.35; white-space: pre-wrap; word-wrap: break-word; border: 1px solid var(--border); }
.msg.user { background: #e8f0fe; margin-left: auto; }
.msg.assistant { background: #f3f4f6; }
.input { display: flex; gap: 8px; padding: 10px; border-top: 1px solid var(--border); }
.input input { flex: 1; border: 1px solid var(--border); border-radius: 8px; padding: 10px 12px; }
.input button { background: var(--primary); color: #fff; border: 0; border-radius: 8px; padding: 10px 12px; cursor: pointer; }
  </style>
</head>
<body>
  <section class="hero">
    <h1>Noack Law — Workers’ Compensation</h1>
    <p>Click “Open Assistant” to chat. It answers from built‑in copy (no external data). It adds the Noack Workers’ Comp link only when relevant, once per conversation, and matches English/Spanish.</p>
    <button class="open-btn" id="openBtn">Open Assistant</button>
  </section>  <div class="overlay" id="overlay" aria-hidden="true"></div>
  <section class="modal" id="modal" role="dialog" aria-modal="true" aria-labelledby="title">
    <header class="header">
      <div class="title" id="title">Noack Assistant</div>
      <button class="close" id="closeBtn" aria-label="Close">✕</button>
    </header>
    <main class="messages" id="messages" aria-live="polite"></main>
    <footer class="input">
      <input id="input" type="text" placeholder="Type your question..." autocomplete="off" />
      <button id="sendBtn">Send</button>
    </footer>
  </section>  <script>
    // Minimal utilities
    function norm(t){return typeof t==="string"?t.replace(/\s+$/g,"").replace(/\r\n/g,"\n"):""}
    function detectLanguage(text){
      if(!text) return "en";
      const t=text.toLowerCase();
      const esHits=["¿","¡","ó","á","é","í","ú","ñ","compensación","laboral","abogado","reclamación","beneficios","lesión"].filter(s=>t.includes(s)).length;
      const enHits=["workers","compensation","workers’","workers'","work","injury","employer","attorney","claim","benefits"].filter(s=>t.includes(s)).length;
      if(esHits>enHits && esHits>=2) return "es";
      if(enHits>=esHits && enHits>=2) return "en";
      if(/[a-z]/i.test(t) && !/[ñáéíóú¿¡]/i.test(t)) return "en";
      return "en";
    }
    function detectTopic(text){
      if(!text) return false;
      const t=text.toLowerCase();
      const pats=[/workers?\s*['’]?\s*comp/i,/work(?:place)?\s+injur/i,/\bclaim(?:s|)\b/i,/\bbenefits?\b/i,/\battorney\b|\blawyer\b|\binsurer\b/i,/compensación\s+laboral/i,/\blesión(?:es)?\s+en\s+el\s+trabajo/i,/\breclamación(?:es)?\b/i];
      return pats.some(re=>re.test(t));
    }
    function detectEmergency(text){
      if(!text) return false;
      const t=text.toLowerCase();
      const pats=[/can't\s+feel\s+my\s+legs|no\s+siento\s+las\s+piernas/i,/difficulty\s+breathing|dificultad\s+para\s+respirar/i,/severe\s+bleeding|hemorragia\s+severa/i,/chest\s+pain|dolor\s+de\s+pecho/i];
      return pats.some(re=>re.test(t));
    }

    // Smart link (topic-relevant, language-matched, once-per-convo)
    const LINK_URL = "https://www.noacklawoffice.com/workers-compensation/";
    const EN_DISCLAIMER = "Note: This information is general and not legal advice. It does not create an attorney–client relationship.";
    const ES_DISCLAIMER = "Aviso: Esta información es general y no constituye asesoramiento legal. No crea una relación abogado–cliente.";
    const EN_PHRASES = [
      u=>`For more information, visit Noack Law Office’s Workers’ Compensation page: ${u}`,
      u=>`Learn more here: ${u}`,
      u=>`You can find additional details at Noack Law Office: ${u}`
    ];
    const ES_PHRASES = [
      u=>`Para más información, visite la página de Compensación Laboral de Noack Law Office: ${u}`,
      u=>`Obtenga más información aquí: ${u}`,
      u=>`Puede encontrar más detalles en Noack Law Office: ${u}`
    ];
    const convoState = { linkShown:false, showCount:0 };

    function applySmartLink({ userMessage, responseText, lang }){
      const safeUser = norm(userMessage||"");
      const safeResp = norm(responseText||"");
      if(!safeResp) return safeResp;
      if(detectEmergency(safeUser)) return safeResp;

      const relevant = detectTopic(`${safeUser}\n${safeResp}`);
      if(!relevant) return safeResp;
      if(convoState.linkShown) return safeResp;

      const phrases = lang==="es" ? ES_PHRASES : EN_PHRASES;
      const disclaimer = lang==="es" ? ES_DISCLAIMER : EN_DISCLAIMER;
      const idx = convoState.showCount % phrases.length;
      const final = safeResp + "\n\n" + disclaimer + "\n" + phrases[idx](LINK_URL);

      convoState.linkShown = true;
      convoState.showCount++;
      return final;
    }

    // Simple built-in answers (no external data/LLM)
    function generateAnswer(userMessage, lang){
      const msg = norm(userMessage||"");
      if(detectEmergency(msg)){
        return lang==="es"
          ? "Si tiene una emergencia médica, llame al 911 o vaya a la sala de emergencias de inmediato. Luego, podemos hablar sobre cómo documentar y reportar la lesión."
          : "If you’re experiencing a medical emergency, call 911 or go to the nearest emergency department immediately. Once you’re safe, we can discuss documenting and reporting the injury.";
      }
      if(detectTopic(msg)){
        return lang==="es"
          ? [
              "Pasos iniciales después de una lesión laboral en Minnesota:",
              "1) Informe la lesión a su empleador lo antes posible (idealmente dentro de 14 días).",
              "2) Busque atención médica y mencione que la lesión es laboral.",
              "3) Guarde registros de fechas, síntomas, testigos y facturas.",
              "4) Si la aseguradora niega o retrasa la reclamación, puede presentar una petición o consultar con un abogado."
            ].join("\n")
          : [
              "First steps after a Minnesota work injury:",
              "1) Report the injury to your employer as soon as possible (ideally within 14 days).",
              "2) Seek medical care and tell the provider the injury is work-related.",
              "3) Keep records of dates, symptoms, witnesses, and medical bills.",
              "4) If the insurer denies or delays the claim, you can file a Claim Petition or consult an attorney."
            ].join("\n");
      }
      return lang==="es"
        ? "Puedo ayudar con preguntas sobre compensación laboral en Minnesota: reportes, beneficios y próximos pasos. ¿Qué le gustaría saber?"
        : "I can help with Minnesota workers’ comp questions: reporting, benefits, and next steps. What would you like to know?";
    }

    // UI
    const overlay = document.getElementById("overlay");
    const modal = document.getElementById("modal");
    const messages = document.getElementById("messages");
    const input = document.getElementById("input");
    const openBtn = document.getElementById("openBtn");
    const closeBtn = document.getElementById("closeBtn");
    const sendBtn = document.getElementById("sendBtn");

    function openChat(){ overlay.classList.add("open"); modal.classList.add("open"); overlay.setAttribute("aria-hidden","false"); setTimeout(()=>input.focus(),100); }
    function closeChat(){ overlay.classList.remove("open"); modal.classList.remove("open"); overlay.setAttribute("aria-hidden","true"); }

    openBtn.addEventListener("click", openChat);
    closeBtn.addEventListener("click", closeChat);
    overlay.addEventListener("click", (e)=>{ if(e.target===overlay) closeChat(); });
    window.addEventListener("keydown",(e)=>{ if(e.key==="Escape" && modal.classList.contains("open")) closeChat(); });

    function addMsg(role,text){ const d=document.createElement("div"); d.className="msg "+role; d.textContent=text; messages.appendChild(d); messages.scrollTop=messages.scrollHeight; }

    function handleSend(){
      const val = (input.value||"").trim();
      if(!val) return;
      input.value = "";
      addMsg("user", val);

      let lang = detectLanguage(val);
      if(lang!=="en" && lang!=="es") lang = "en";

      const base = generateAnswer(val, lang);
      const final = applySmartLink({ userMessage: val, responseText: base, lang });
      addMsg("assistant", final);
    }
    sendBtn.addEventListener("click", handleSend);
    input.addEventListener("keydown", (e)=>{ if(e.key==="Enter"){ e.preventDefault(); handleSend(); } });

    // Auto-open so you immediately see it
    window.addEventListener("load", () => setTimeout(openChat, 600));
  </script></body>
</html>
